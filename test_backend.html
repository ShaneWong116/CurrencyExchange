<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°æœåŠ¡æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1976d2;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-item {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid #1976d2;
        }
        .btn {
            background: #1976d2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #1565c0;
        }
        .btn.success { background: #4caf50; }
        .btn.success:hover { background: #45a049; }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.ok {
            background: #4caf50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .status.testing {
            background: #ff9800;
            color: white;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ åå°æœåŠ¡æµ‹è¯•é¡µé¢</h1>
        
        <div class="test-item">
            <h3>1. APIå¥åº·æ£€æŸ¥ <span id="health-status" class="status testing">æµ‹è¯•ä¸­...</span></h3>
            <p>æµ‹è¯•åŸºç¡€APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ</p>
            <button class="btn" onclick="testHealth()">æµ‹è¯• /api/health</button>
            <div id="health-result" class="result"></div>
        </div>

        <div class="test-item">
            <h3>2. åå°ç®¡ç†é¡µé¢ <span id="admin-status" class="status testing">æµ‹è¯•ä¸­...</span></h3>
            <p>æµ‹è¯•åå°ç®¡ç†ç•Œé¢æ˜¯å¦å¯ä»¥è®¿é—®</p>
            <button class="btn" onclick="testAdmin()">æµ‹è¯• /admin</button>
            <a href="http://localhost:8000/admin" target="_blank" class="btn success">ç›´æ¥æ‰“å¼€åå°</a>
            <div id="admin-result" class="result"></div>
        </div>

        <div class="test-item">
            <h3>3. ç™»å½•åŠŸèƒ½æµ‹è¯• <span id="login-status" class="status testing">å¾…æµ‹è¯•</span></h3>
            <p>æµ‹è¯•ç”¨æˆ·ç™»å½•APIåŠŸèƒ½</p>
            <button class="btn" onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
            <div id="login-result" class="result"></div>
        </div>

        <div class="test-item">
            <h3>4. æ•°æ®æ¥å£æµ‹è¯• <span id="data-status" class="status testing">å¾…æµ‹è¯•</span></h3>
            <p>æµ‹è¯•ä¸šåŠ¡æ•°æ®APIæ¥å£</p>
            <button class="btn" onclick="testChannels()">æµ‹è¯•æ¸ é“æ¥å£</button>
            <button class="btn" onclick="testTransactions()">æµ‹è¯•äº¤æ˜“æ¥å£</button>
            <div id="data-result" class="result"></div>
        </div>

        <div class="test-item">
            <h3>ğŸ¯ å¿«é€Ÿè®¿é—®é“¾æ¥</h3>
            <a href="http://localhost:8000/admin" target="_blank" class="btn success">ğŸ›ï¸ åå°ç®¡ç†</a>
            <a href="http://localhost:8000/api/health" target="_blank" class="btn">ğŸ“¡ APIå¥åº·æ£€æŸ¥</a>
            <a href="test_api.html" target="_blank" class="btn">ğŸ“‹ å®Œæ•´APIæµ‹è¯•</a>
            <a href="admin.html" target="_blank" class="btn">ğŸ›ï¸ ç®¡ç†æ§åˆ¶å°</a>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            testHealth();
            testAdmin();
        };

        async function testHealth() {
            const statusEl = document.getElementById('health-status');
            const resultEl = document.getElementById('health-result');
            
            statusEl.textContent = 'æµ‹è¯•ä¸­...';
            statusEl.className = 'status testing';
            resultEl.style.display = 'block';
            resultEl.innerHTML = 'æ­£åœ¨æµ‹è¯• API å¥åº·æ£€æŸ¥...';

            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    statusEl.textContent = 'âœ… æ­£å¸¸';
                    statusEl.className = 'status ok';
                    resultEl.innerHTML = `<strong>æˆåŠŸï¼</strong><br>æœåŠ¡å™¨å“åº”: ${data.message}<br>æ—¶é—´æˆ³: ${data.timestamp}`;
                } else {
                    throw new Error('APIå“åº”å¼‚å¸¸');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'status error';
                resultEl.innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testAdmin() {
            const statusEl = document.getElementById('admin-status');
            const resultEl = document.getElementById('admin-result');
            
            statusEl.textContent = 'æµ‹è¯•ä¸­...';
            statusEl.className = 'status testing';
            resultEl.style.display = 'block';
            resultEl.innerHTML = 'æ­£åœ¨æµ‹è¯•åå°ç®¡ç†é¡µé¢...';

            try {
                const response = await fetch(`${API_BASE}/admin`);
                const text = await response.text();
                
                if (response.ok && text.includes('è´¢åŠ¡ç®¡ç†ç³»ç»Ÿ')) {
                    statusEl.textContent = 'âœ… æ­£å¸¸';
                    statusEl.className = 'status ok';
                    resultEl.innerHTML = '<strong>æˆåŠŸï¼</strong><br>åå°ç®¡ç†é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®<br><a href="http://localhost:8000/admin" target="_blank">ç‚¹å‡»è¿™é‡Œæ‰“å¼€åå°</a>';
                } else {
                    throw new Error('åå°é¡µé¢å†…å®¹å¼‚å¸¸');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'status error';
                resultEl.innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testLogin() {
            const statusEl = document.getElementById('login-status');
            const resultEl = document.getElementById('login-result');
            
            statusEl.textContent = 'æµ‹è¯•ä¸­...';
            statusEl.className = 'status testing';
            resultEl.style.display = 'block';
            resultEl.innerHTML = 'æ­£åœ¨æµ‹è¯•ç™»å½•åŠŸèƒ½...';

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    statusEl.textContent = 'âœ… æ­£å¸¸';
                    statusEl.className = 'status ok';
                    resultEl.innerHTML = `<strong>ç™»å½•æˆåŠŸï¼</strong><br>ç”¨æˆ·: ${data.user.name} (${data.user.role})`;
                } else {
                    throw new Error(data.message || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'status error';
                resultEl.innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testChannels() {
            const statusEl = document.getElementById('data-status');
            const resultEl = document.getElementById('data-result');
            
            statusEl.textContent = 'æµ‹è¯•ä¸­...';
            statusEl.className = 'status testing';
            resultEl.style.display = 'block';
            resultEl.innerHTML = 'æ­£åœ¨æµ‹è¯•æ¸ é“æ¥å£...';

            try {
                const response = await fetch(`${API_BASE}/api/channels`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    statusEl.textContent = 'âœ… æ­£å¸¸';
                    statusEl.className = 'status ok';
                    resultEl.innerHTML = `<strong>æ¸ é“æ¥å£æ­£å¸¸ï¼</strong><br>è¿”å› ${data.data.length} ä¸ªæ”¯ä»˜æ¸ é“`;
                } else {
                    throw new Error('æ¸ é“æ¥å£å¼‚å¸¸');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'status error';
                resultEl.innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }

        async function testTransactions() {
            const statusEl = document.getElementById('data-status');
            const resultEl = document.getElementById('data-result');
            
            resultEl.style.display = 'block';
            resultEl.innerHTML = 'æ­£åœ¨æµ‹è¯•äº¤æ˜“æ¥å£...';

            try {
                const response = await fetch(`${API_BASE}/api/transactions`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    statusEl.textContent = 'âœ… æ­£å¸¸';
                    statusEl.className = 'status ok';
                    resultEl.innerHTML = `<strong>äº¤æ˜“æ¥å£æ­£å¸¸ï¼</strong><br>è¿”å› ${data.data.length} ä¸ªäº¤æ˜“è®°å½•`;
                } else {
                    throw new Error('äº¤æ˜“æ¥å£å¼‚å¸¸');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'status error';
                resultEl.innerHTML = `<strong>é”™è¯¯:</strong> ${error.message}`;
            }
        }
    </script>
</body>
</html>
