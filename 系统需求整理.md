# 货币交换系统需求整理

## 一、系统概述

本系统是一个货币交换系统，将**人民币作为"商品"**进行交易管理，核心功能包括交易记录、渠道余额管理和结余结算。

---

## 二、交易类型

### 2.1 入账交易
**业务含义**：收入人民币（商品），该批人民币的价值为港币金额

**输入字段**：
- 人民币金额：收入的人民币数量
- 港币金额：该批人民币的价值（港币计价）
- 汇率：人民币金额 ÷ 港币金额
- 渠道：交易渠道

**业务逻辑**：
1. 记录交易详情（人民币金额、港币金额、汇率、渠道、交易时间等）
2. 对应渠道的人民币余额增加（+人民币金额）
3. 交易状态初始为"未结余"
4. **不影响港币结余**（港币结余仅在结余时更新）

---

### 2.2 出账交易
**业务含义**：支出人民币（商品），该批人民币的价值为港币金额

**输入字段**：
- 人民币金额：支出的人民币数量
- 港币金额：该批人民币的价值（港币计价）
- 汇率：人民币金额 ÷ 港币金额
- 渠道：交易渠道

**业务逻辑**：
1. 记录交易详情（人民币金额、港币金额、汇率、渠道、交易时间等）
2. 对应渠道的人民币余额减少（-人民币金额）
3. 交易状态初始为"未结余"
4. **不影响港币结余**（港币结余仅在结余时更新）

---

### 2.3 即时买断交易
**业务含义**：收入人民币后立即按约定汇率卖出,获得港币收益（一次交易完成买入和卖出）

**输入字段**：
- 人民币金额：收入的人民币数量（用户输入）
- 港币金额：该批人民币的港币成本（用户输入）
- 汇率：人民币金额 ÷ 港币金额（自动计算，保留3位小数）
- 即时买断汇率：卖出人民币时使用的汇率（用户输入）
- 渠道：交易渠道

**业务逻辑**：
1. **只记录一条交易**，交易类型为 `instant_buyout`（即时买断）
2. 记录交易详情（人民币金额、港币成本、买入汇率、即时买断汇率、渠道、交易时间等）
3. **不影响渠道人民币余额**（人民币立即买入卖出，不进入库存）
4. **不影响港币余额**（港币收支在结余时统一处理）
5. 交易状态初始为"未结余"
6. **即时买断利润在结余时计算**

**字段说明**：
- **汇率**（exchange_rate）：买入人民币的成本汇率（人民币金额 ÷ 港币成本）
- **即时买断汇率**（instant_rate）：卖出人民币时的汇率（用户约定的卖出价格）
- **港币成本**（hkd_amount）：买入人民币时支付的港币金额
- **港币卖出金额**：卖出人民币时收到的港币金额（结余时计算：人民币金额 ÷ 即时买断汇率）
- **即时买断利润**：港币卖出金额 - 港币成本（结余时计算并记录）

---

## 三、结余功能

### 3.1 操作流程
1. 点击"结余"按钮
2. 系统显示结余预览（包含各项计算数据）
3. 用户核对关键数据：
   - 原本金（上次结余后的本金）
   - 人民币结余（当前人民币余额汇总）
   - 利润（本次结余计算的利润）
   - 新本金（本次结余后的本金）
4. 用户填写"其他支出"（可选）
5. 用户点击"确认结余"
6. 系统弹出密码验证框，要求输入确认密码
7. 密码验证通过后，系统执行结余操作并保存结余记录
8. 显示结余成功提示

### 3.1.1 结余频率限制
- **每天最多只能结余一次**
- 如果当天已经结余过，系统应提示"今日已完成结余，无法重复操作"
- 结余记录按结余时间（日期）进行组织和展示

### 3.2 结余预览信息

#### (1) 本金
- **定义**：全局可编辑变量（港币金额）
- **初始化**：系统首次使用时手动输入
- **更新规则**：每次结余后，本金 = 原本金 + 利润 - 其他支出
- **作用**：作为下一次结余的初始本金

#### (1.5) 港币结余
- **定义**：全局变量（港币金额）
- **初始化**：系统首次使用时手动输入
- **更新规则**：每次结余后，港币结余 = 原港币结余 + 利润
- **重要说明**：入账、出账交易**不影响**港币结余，仅结余时更新

#### (2) 当前结余汇率
**重要说明**：
- **当前结余汇率仅在点击结余时计算**
- 平时查看余额时不进行汇率计算
- 汇率计算时机：用户点击"结余"按钮，系统生成结余预览时

**计算公式**：
```
当前结余汇率 = 人民币总量 ÷ 港币总量

其中：
人民币总量 = 当前各渠道人民币余额汇总 + 未结余入账人民币金额之和
港币总量 = 当前港币结余 + 未结余入账港币金额之和
```

**说明**：
- 人民币结余：当前各渠道人民币余额汇总（所有渠道的人民币余额之和）
- 未结余入账人民币金额之和：状态为"未结余" + 类型为"入账"的交易的人民币金额总和
- 港币结余：系统维护的港币余额（全局变量）
- 未结余入账港币金额之和：状态为"未结余" + 类型为"入账"的交易的港币金额总和

#### (3) 利润
利润分为两部分：**出账利润** 和 **即时买断利润**

##### (3.1) 出账利润
**计算公式**：
```
出账利润 = 当前未结余的出账港币总额 - 当前未结余的出账港币成本

其中：
当前未结余的出账港币总额 = SUM(状态为"未结余" AND 类型为"出账"的港币金额)
当前未结余的出账港币成本 = (SUM(状态为"未结余" AND 类型为"出账"的人民币金额)) ÷ 当前结余汇率
```

**说明**：
- 出账港币总额：实际收到的港币
- 出账港币成本：出账人民币按当前结余汇率折算的港币价值
- 出账利润 = 收入 - 成本

##### (3.2) 即时买断利润
**计算公式**：
```
即时买断利润 = 港币卖出金额 - 港币成本之和

其中：
港币成本之和 = SUM(状态为"未结余" AND 类型为"即时买断"的港币金额)
人民币之和 = SUM(状态为"未结余" AND 类型为"即时买断"的人民币金额)
港币卖出金额 = 人民币之和 ÷ 即时买断汇率（保留整数，四舍五入到十位）
```

**说明**：
- 港币成本之和：收入即时买断人民币时支付的港币总额
- 人民币之和：所有即时买断交易的人民币总额
- 即时买断汇率：用户输入的卖出汇率（所有即时买断交易使用相同汇率）
- 港币卖出金额：卖出人民币后收到的港币总额
- 即时买断利润 = 卖出收入 - 成本

**重要说明**：
- 即时买断汇率在结余预览时由用户输入
- 所有未结余的即时买断交易使用同一个即时买断汇率计算利润
- 港币卖出金额保留整数（四舍五入到十位）

##### (3.3) 总利润
**计算公式**：
```
总利润 = 出账利润 + 即时买断利润
```

#### (4) 人民币余额
- 当前各渠道人民币余额的汇总

#### (5) 结余后本金
**计算公式**：
```
结余后本金 = 当前本金 + 总利润 - 其他支出
```

#### (6) 结余后港币结余
**计算公式**：
```
结余后港币结余 = 当前港币结余 + 总利润
```

### 3.3 其他支出明细
根据参考表格，其他支出需要显示详细分类，包括但不限于：
- 项目：支出项目名称（如：资金、薪金、金流费用、旺金、电费、化红等）
- 金额：各项支出的具体金额
- 总支出：所有其他支出的汇总

**界面要求**：
- 结余预览时可以输入多项其他支出
- 每项支出需要记录项目名称和金额
- 结余后的结余页面需要完整展示所有其他支出明细

---

## 四、数据结构设计建议

### 4.1 交易表（transactions）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 交易ID |
| type | 枚举 | 交易类型：入账/出账/即时买断 |
| rmb_amount | 数值 | 人民币金额 |
| hkd_amount | 数值 | 港币金额 |
| exchange_rate | 数值 | 汇率 |
| instant_rate | 数值 | 即时买断汇率（仅即时买断类型） |
| channel_id | 外键 | 渠道ID |
| settlement_status | 枚举 | 结余状态：已结余/未结余 |
| settlement_id | 外键 | 所属结余批次ID（已结余时） |
| created_at | 时间戳 | 交易时间 |

### 4.2 渠道表（channels）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 渠道ID |
| name | 字符串 | 渠道名称 |
| rmb_balance | 数值 | 人民币余额 |

### 4.3 系统设置表（settings）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| key | 主键 | 设置项键名 |
| value | 文本 | 设置项值 |

**关键设置项**：
- `capital`：当前本金（数值）
- `hkd_balance`：当前港币结余（数值）
- `settlement_password`：结余确认密码（加密存储）

### 4.4 结余记录表（settlements）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 结余ID |
| settlement_date | 日期 | 结余日期（YYYY-MM-DD，每天唯一） |
| previous_capital | 数值 | 结余前本金（原本金） |
| previous_hkd_balance | 数值 | 结余前港币结余 |
| outgoing_profit | 数值 | 出账利润 |
| instant_profit | 数值 | 即时买断利润 |
| total_profit | 数值 | 总利润（出账利润+即时买断利润） |
| instant_buyout_rate | 数值 | 即时买断汇率（结余时使用） |
| other_expenses_total | 数值 | 其他支出总额 |
| new_capital | 数值 | 结余后本金（新本金） |
| new_hkd_balance | 数值 | 结余后港币结余 |
| settlement_rate | 数值 | 结余汇率 |
| rmb_balance_total | 数值 | 人民币余额汇总 |
| remark | 文本 | 备注 |
| created_at | 时间戳 | 结余时间 |
| created_by | 外键 | 执行结余的用户ID |

**索引**：
- settlement_date：唯一索引（确保每天最多一条记录）

### 4.5 其他支出明细表（settlement_expenses）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 支出明细ID |
| settlement_id | 外键 | 所属结余ID |
| item_name | 字符串 | 支出项目名称 |
| amount | 数值 | 支出金额 |
| created_at | 时间戳 | 创建时间 |

---

## 五、核心业务规则

### 5.1 交易规则
1. 每笔交易必须关联一个渠道
2. 汇率 = 人民币金额 ÷ 港币金额（自动计算，保留3位小数）
3. 入账：渠道人民币余额增加
4. 出账：渠道人民币余额减少
5. 即时买断：**不影响**渠道人民币余额（人民币不进入库存）
6. 即时买断交易需记录即时买断汇率，在结余时使用

### 5.2 结余规则
1. **每天最多结余一次**：同一日期（YYYY-MM-DD）只能有一条结余记录
2. 点击"结余"按钮时检查当天是否已结余，如已结余则提示并禁止操作
3. 结余仅处理状态为"未结余"的交易
4. 利润计算仅在点击结余时进行，平时不计算
5. 结余预览时展示核对数据：原本金、人民币结余、利润、新本金
6. 用户核对无误后，需输入确认密码才能完成结余
7. 密码验证通过后，系统执行以下操作：
   - 将相关交易状态更新为"已结余"
   - 系统本金更新为"结余后本金"（本金 + 总利润 - 其他支出）
   - 港币结余更新为"结余后港币结余"（港币结余 + 总利润）
   - 其他支出明细保存到数据库，关联到结余记录
   - 创建结余记录，记录当天日期
8. 所有计算结果保留至小数点后3位
9. 即时买断汇率在结余预览时由用户输入，保存到结余记录中
10. 港币卖出金额计算时保留整数（四舍五入到十位）
11. 总利润 = 出账利润 + 即时买断利润

### 5.3 数据一致性
1. 渠道余额 = 所有入账人民币之和 - 所有出账人民币之和（**不包含即时买断交易**）
2. 每次结余后创建结余记录，交易关联到结余批次
3. 已结余的交易不可修改和删除
4. 即时买断交易的人民币不计入渠道余额

---

## 六、功能模块

### 6.1 交易管理
- 新增入账交易
- 新增出账交易
- 新增即时买断交易
- 查看交易列表（筛选：渠道、类型、结余状态、时间范围）
- 查看交易详情

### 6.2 渠道管理
- 新增渠道
- 编辑渠道
- 查看渠道列表及余额

### 6.3 结余管理
- 结余预览（显示原本金、人民币结余、利润、新本金等核对数据）
- 填写即时买断汇率（如有未结余的即时买断交易时需要输入）
- 填写其他支出（支持多项支出，每项包含项目名称和金额）
- 密码验证（二次确认机制）
- 执行结余操作
- 结余历史记录查看（按日期展示，每天最多一条）
- 结余详情页（展示完整的结余报告，包含所有明细）

### 6.3.1 结余权限说明
- **外勤人员端**：可以进行结余操作，流程与后台一致（预览 → 核对 → 密码验证 → 确认），但无法查看完整的收入支出表
- **系统后台**：可以进行结余操作，且可以查看完整的收入支出表和所有历史记录

### 6.4 系统设置
- 设置/修改本金
- 设置/修改港币结余
- 设置/修改人民币结余
- 查看系统状态

---

## 七、计算示例

### 7.1 示例场景一：包含入账、出账交易
**初始状态**：
- 本金：1,000,000 HKD
- 港币结余：526,315 HKD
- 人民币结余：500,000 CNY（各渠道余额汇总）

**交易记录**（所有交易状态均为"未结余"）：
1. 入账：收入 CNY 9,500，价值 HKD 10,000，汇率 0.950
2. 入账：收入 CNY 19,000，价值 HKD 20,000，汇率 0.950
3. 出账：支出 CNY 14,250，价值 HKD 15,000，汇率 0.950

**渠道状态**（结余前）：
- 渠道A人民币余额：514,250 CNY
  - 计算：500,000（初始余额）+ 9,500（入账1）+ 19,000（入账2）- 14,250（出账3）= 514,250 CNY

**结余计算**：

1. **当前结余汇率**：
   ```
   人民币总量 = 514,250（渠道余额汇总）+ 28,500（未结余入账CNY：9,500+19,000）= 542,750 CNY
   港币总量 = 526,315（港币结余）+ 30,000（未结余入账HKD：10,000+20,000）= 556,315 HKD
   当前结余汇率 = 542,750 ÷ 556,315 ≈ 0.976（保留三位小数）
   ```
   > **说明**：人民币总量中的"渠道余额汇总"已经包含了所有交易（入账+出账）的影响，
   > 但为了计算当前的整体汇率，需要加上"未结余入账"交易的港币价值。

2. **出账利润**：
   ```
   出账港币总额 = 15,000 HKD（出账交易的港币价值）
   出账港币成本 = 14,250（出账CNY）÷ 0.976（当前结余汇率）≈ 14,600 HKD（四舍五入，保留整数）
   出账利润 = 15,000 - 14,600 = 400 HKD
   ```
   > **说明**：利润 = 出账时收到的港币 - 出账人民币按当前结余汇率计算的成本

3. **即时买断利润**：
   ```
   本示例无即时买断交易
   即时买断利润 = 0 HKD
   ```

4. **总利润**：
   ```
   总利润 = 400（出账利润）+ 0（即时买断利润）= 400 HKD
   ```

5. **结余后本金**（假设其他支出总额为 300 HKD）：
   ```
   其他支出明细：
   - 薪金：100 HKD
   - 金流费用：200 HKD
   - 总支出：300 HKD
   
   结余后本金 = 1,000,000（当前本金）+ 400（总利润）- 300（其他支出）= 1,000,100 HKD
   ```

6. **结余后港币结余**：
   ```
   结余后港币结余 = 526,315（当前港币结余）+ 400（总利润）= 526,715 HKD
   ```

**结余后状态更新**：
- 本金：1,000,100 HKD（更新全局设置）
- 港币结余：526,715 HKD（更新全局设置）
- 所有未结余交易状态更新为"已结余"
- 创建结余记录，保存所有计算结果和其他支出明细

---

### 7.2 示例场景二：包含即时买断交易
**初始状态**：
- 本金：1,000,000 HKD
- 港币结余：526,315 HKD
- 人民币结余：500,000 CNY（各渠道余额汇总）

**交易记录**（所有交易状态均为"未结余"）：
1. 即时买断：收入 CNY 9,500，价值 HKD 10,000，汇率 0.950，即时买断汇率 0.929
2. 即时买断：收入 CNY 19,000，价值 HKD 20,000，汇率 0.950，即时买断汇率 0.929

**渠道状态**（结余前）：
- 渠道A人民币余额：500,000 CNY（即时买断不影响渠道余额）

**结余计算**：

1. **当前结余汇率**：
   ```
   人民币总量 = 500,000（渠道余额汇总，无变化）
   港币总量 = 526,315（港币结余，无入账交易）
   当前结余汇率 = 500,000 ÷ 526,315 ≈ 0.950（保留三位小数）
   ```
   > **说明**：即时买断交易不计入结余汇率的计算（人民币不进入库存）

2. **出账利润**：
   ```
   本示例无出账交易
   出账利润 = 0 HKD
   ```

3. **即时买断利润**：
   ```
   港币成本之和 = 10,000 + 20,000 = 30,000 HKD
   人民币之和 = 9,500 + 19,000 = 28,500 CNY
   即时买断汇率 = 0.929（用户输入）
   港币卖出金额 = 28,500 ÷ 0.929 ≈ 30,680 HKD（保留整数，四舍五入到十位）
   即时买断利润 = 30,680 - 30,000 = 680 HKD
   ```
   > **说明**：即时买断利润 = 卖出人民币收到的港币 - 收入人民币时支付的港币

4. **总利润**：
   ```
   总利润 = 0（出账利润）+ 680（即时买断利润）= 680 HKD
   ```

5. **结余后本金**（假设其他支出总额为 300 HKD）：
   ```
   其他支出明细：
   - 薪金：100 HKD
   - 金流费用：200 HKD
   - 总支出：300 HKD
   
   结余后本金 = 1,000,000（当前本金）+ 680（总利润）- 300（其他支出）= 1,000,380 HKD
   ```

6. **结余后港币结余**：
   ```
   结余后港币结余 = 526,315（当前港币结余）+ 680（总利润）= 526,995 HKD
   ```

**结余后状态更新**：
- 本金：1,000,380 HKD（更新全局设置）
- 港币结余：526,995 HKD（更新全局设置）
- 所有未结余交易状态更新为"已结余"
- 即时买断汇率（0.929）保存到结余记录中
- 创建结余记录，保存所有计算结果和其他支出明细

---

## 八、技术实现建议

### 8.1 前端
- 交易录入界面（表单验证）
- 结余预览弹窗（实时计算）
- 数据可视化（Dashboard）

### 8.2 后端
- RESTful API 设计
- 事务处理（确保数据一致性）
- 计算逻辑封装成服务类

### 8.3 数据库
- 使用数据库事务保证结余操作的原子性
- 添加索引优化查询性能
- 软删除机制保护历史数据

---

## 九、结余页面展示要求

### 9.1 结余预览页面
点击"结余"按钮后，首先显示结余预览页面，供用户核对数据：

#### 9.1.1 核对数据区域（醒目显示）
```
┌────────────────────────────────────────────┐
│  结余预览 - 请核对以下数据                 │
├────────────────────────────────────────────┤
│  ✓ 原本金（上次结余后）：1,000,000 HKD     │
│  ✓ 人民币结余：514,250 CNY                │
│  ✓ 利润（本次结余）：1,080 HKD            │
│  ✓ 新本金（本次结余后）：1,000,780 HKD    │
├────────────────────────────────────────────┤
│  详细计算：                                │
│  - 出账利润：400 HKD                      │
│  - 即时买断利润：680 HKD                  │
│  - 总利润：1,080 HKD                      │
│  - 结余汇率：0.976                        │
│  - 即时买断汇率：0.929（如有）            │
├────────────────────────────────────────────┤
│  其他支出（可输入）                        │
│  ├─ [输入框] 支出项目名称  [输入框] 金额  │
│  ├─ [+ 添加支出项]                        │
│  └─ 总支出：300 HKD                       │
├────────────────────────────────────────────┤
│  [返回] [确认结余]                         │
└────────────────────────────────────────────┘
```

点击"确认结余"后弹出密码验证框：
```
┌────────────────────────────────────────────┐
│  密码验证                                  │
├────────────────────────────────────────────┤
│  请输入确认密码以完成结余操作：            │
│  [密码输入框]                              │
├────────────────────────────────────────────┤
│  [取消] [确认]                             │
└────────────────────────────────────────────┘
```

### 9.2 结余记录列表
结余记录按日期展示，以表格形式显示（每天最多一条记录）：

| 日期 | 本金 | 利润 | 支出 | 结余本金 | 人民币结余 | 备注 | 操作 |
|------|------|------|------|----------|-----------|------|------|
| 2025.7.1 | 1,000,000 | 1,080 | 300 | 1,000,780 | 514,250 | 备注内容 | [查看详情] |
| 2025.6.30 | 995,000 | 5,200 | 200 | 1,000,000 | 500,000 | - | [查看详情] |

**说明**：
- 所有金额均显示总金额
- 点击"查看详情"可展开显示完整的结余报告

### 9.3 结余详情页面
点击"查看详情"后显示完整的结余报告：

```
┌────────────────────────────────────────────┐
│  收入支出表          日期: 2025.7.1        │
├────────────────────────────────────────────┤
│  原本金: 1,000,000 HKD                     │
│  出账利润: 400 HKD                         │
│  即时买断利润: 680 HKD                     │
│  总利润: 1,080 HKD                         │
│  总支出: 300 HKD                           │
│  结余本金: 1,000,780 HKD                   │
│  人民币结余: 514,250 CNY                   │
│  结余汇率: 0.976                           │
│  即时买断汇率: 0.929                       │
├────────────────────────────────────────────┤
│  其他支出明细:                             │
│  ├─ 薪金:      100 HKD                    │
│  ├─ 金流费用:  200 HKD                    │
│  └─ 总支出:    300 HKD                    │
├────────────────────────────────────────────┤
│  备注: 备注内容                            │
└────────────────────────────────────────────┘
```

---

## 十、即时买断功能要点总结

### 10.1 核心特点
1. **不进入库存**：即时买断的人民币不计入渠道余额
2. **独立利润计算**：即时买断利润独立于出账利润单独计算
3. **结余时确定汇率**：即时买断汇率在结余预览时由用户输入
4. **统一汇率处理**：所有未结余的即时买断交易使用同一个即时买断汇率计算

### 10.2 与入账、出账的区别

| 特性 | 入账 | 出账 | 即时买断 |
|------|------|------|----------|
| 影响渠道余额 | 是（增加） | 是（减少） | **否** |
| 影响结余汇率 | 是 | 否 | **否** |
| 利润计算时机 | - | 结余时 | **结余时** |
| 利润计算方式 | - | 按结余汇率计算成本 | **按即时买断汇率计算卖出金额** |
| 记录字段 | 人民币、港币、汇率 | 人民币、港币、汇率 | **人民币、港币、汇率、即时买断汇率** |

### 10.3 关键计算公式
```
即时买断利润 = 港币卖出金额 - 港币成本之和

其中：
港币成本之和 = SUM(未结余即时买断交易的港币金额)
人民币之和 = SUM(未结余即时买断交易的人民币金额)
港币卖出金额 = 人民币之和 ÷ 即时买断汇率（保留整数，四舍五入到十位）
```

### 10.4 业务场景说明
即时买断适用于以下场景：
- 收到人民币后立即以约定价格卖出
- 人民币不进入公司库存周转
- 通过买卖差价获得利润

---

## 十一、密码验证与权限管理

### 11.1 结余确认密码
- **用途**：用于结余操作的二次验证
- **设置方式**：在系统设置中配置结余确认密码
- **验证时机**：用户在结余预览页面点击"确认结余"后
- **验证流程**：
  1. 弹出密码输入对话框
  2. 用户输入确认密码
  3. 系统验证密码是否正确
  4. 验证通过：执行结余操作
  5. 验证失败：提示"密码错误"，不执行结余操作

### 11.2 用户角色与权限
系统支持两种用户角色：

#### 11.2.1 外勤人员
**可访问功能**：
- 交易管理（新增入账、出账、即时买断交易）
- 查看渠道列表及余额
- 执行结余操作（预览 → 核对 → 密码验证 → 确认）
- 查看结余历史记录（基础信息）

**不可访问功能**：
- 完整的收入支出表（详细的结余报告）
- 系统设置（本金、港币结余等全局设置）
- 用户管理

#### 11.2.2 系统管理员（后台）
**可访问所有功能**：
- 所有外勤人员可访问的功能
- 完整的收入支出表查看
- 系统设置管理
- 用户管理
- 审计日志查看

---

## 十二、待补充功能

### 12.1 数据导出
- 结余报告导出（Excel/PDF）
- 交易记录导出

### 12.2 数据备份
- 定期数据备份机制
- 数据恢复功能

---

**文档版本**：v4.0  
**创建日期**：2025-10-23  
**最后更新**：2025-10-24  
**更新内容**：
- v4.0：完善结余功能流程（预览、核对、密码验证、频率限制）
- v3.0：新增即时买断交易功能完整设计

