# 需求文档

## 介绍

本文档概述了货币兑换系统的完善需求，重点关注财务报告功能、数据管理功能和前端用户界面增强。系统需要提供全面的日结、月结和年结财务报告，支持Excel导出功能，改进资本显示计算，提供安全的数据管理功能，以及具有底部导航的现代化移动友好前端界面。

## 需求

### 需求1：日结报告生成功能

**用户故事：** 作为财务管理员，我希望生成带有Excel导出功能的日结报告，以便跟踪每日渠道余额和利润进行财务对账。

#### 验收标准

1. 当用户点击"日结"时，系统应生成包含所有渠道余额（人民币）、总余额、所有渠道利润和总利润的Excel报告
2. 当计算单个渠道余额时，系统应使用公式：昨日结余 + 当天收入人民币 - 当天支出人民币
3. 当计算单个渠道利润时，系统应使用公式：当天港币收入 - 当天港币支出
4. 当计算总余额时，系统应汇总所有渠道余额
5. 当计算总利润时，系统应汇总所有渠道利润
6. 当日结完成后，系统应将各渠道余额保存为结余余额供次日使用

### 需求2：月结报告生成功能

**用户故事：** 作为财务管理员，我希望生成包含额外支出跟踪的月结报告，以便分析包括杂项支出在内的月度财务表现。

#### 验收标准

1. 当用户点击"月结"时，系统应生成包含以下列的Excel报告：日期、本金、总收入、总支出、其他支出、总利润
2. 当填充日期时，系统应包含选定月份内的所有记录日期
3. 当计算本金时，系统应使用每个日期的"昨日结余"（人民币）
4. 当计算总收入时，系统应汇总每个日期的港币总收入
5. 当计算总支出时，系统应汇总每个日期的港币总支出
6. 当用户点击月结时，系统应提供界面供添加其他支出（支出名称和港币金额）
7. 当计算总利润时，系统应使用公式：总收入 - 总支出 - 其他支出

### 需求3：年结报告生成功能

**用户故事：** 作为财务管理员，我希望生成包含全面支出跟踪的年结报告，以便进行年度财务分析和规划。

#### 验收标准

1. 当用户点击"年结"时，系统应生成包含以下列的Excel报告：月份、本金、总收入、总支出、其他支出、总利润
2. 当填充月份时，系统应包含选定年份内的所有记录月份
3. 当计算本金时，系统应使用每个月份的"昨日结余"（人民币）
4. 当计算总收入时，系统应汇总每个月份的港币总收入
5. 当计算总支出时，系统应汇总每个月份的港币总支出
6. 当用户点击年结时，系统应提供界面供添加其他支出（支出名称和港币金额）
7. 当计算总利润时，系统应使用公式：总收入 - 总支出 - 其他支出

### 需求4：首页本金显示增强

**用户故事：** 作为系统用户，我希望在首页看到准确的本金信息，以便快速了解当前财务状况。

#### 验收标准

1. 当显示首页本金时，系统应显示所有渠道"昨日结余"（人民币）的总和
2. 当渠道余额更新时，首页本金显示应立即反映变化
3. 当不存在之前余额时，系统应显示零作为本金金额

### 需求5：数据管理和清理功能

**用户故事：** 作为系统管理员，我希望能够安全地清理系统数据并进行精细控制，以便维护数据卫生并符合数据保留政策。

#### 验收标准

1. 当访问数据清理页面时，系统应提供选择时间范围的选项（日、月、年、所有）
2. 当选择清理内容时，系统应支持多选和全选：渠道、余额、账号、账单、地点
3. 当用户点击"清空数据"时，系统应显示确认对话框，警告"是否清空所有数据，清空后无法恢复"
4. 当确认对话框出现时，系统应要求输入二次验证密码
5. 当用户点击"确定"且密码正确时，系统应清空选定数据并显示"清空成功"
6. 当用户点击"取消"或密码错误时，系统不应清空任何数据
7. 当尝试清空数据时，系统应记录操作以供审计

### 需求6：前端导航结构重新设计

**用户故事：** 作为移动用户，我希望使用底部导航栏浏览系统，以便在移动设备上轻松访问应用程序的不同部分。

#### 验收标准

1. 当访问前端应用程序时，系统应显示包含三个部分的底部导航栏：首页、记录、个人
2. 当用户点击导航项时，系统应切换到相应页面
3. 当在特定页面时，系统应高亮显示活动导航项
4. 当显示导航时，系统应在所有页面保持一致的样式

### 需求7：交易记录页面实现

**用户故事：** 作为系统用户，我希望查看带有统计摘要的交易记录，以便跟踪我的交易活动和表现。

#### 验收标准

1. 当访问记录页面时，系统应显示包含系统标志和用户信息及退出选项的头部
2. 当加载记录页面时，系统应显示今日统计卡片，包括：总笔数、入账、出账、净额
3. 当加载交易列表时，系统应显示交易信息：交易类型（入账/出账）、渠道、金额及货币、时间戳、交易编号、状态和可选备注
4. 当显示交易时，系统应将其格式化为具有清晰视觉层次的单独卡片
5. 当交易列表很长时，系统应支持滚动查看所有交易

### 需求8：即时买断交易类型标识

**用户故事：** 作为财务管理员，我希望即时买断交易能够被正确标识和分类，以便在后台进行类型筛选和统计分析。

#### 验收标准

1. 当执行即时买断操作时，系统应保持现有功能：同时生成一条入账记录和一条出账记录
2. 当生成即时买断交易记录时，系统应为两条记录添加"即时买断"类型标签，但不改变原有的入账/出账（收入/支出）属性
3. 当在后台查看交易记录时，系统应支持按"即时买断"类型标签进行筛选
4. 当生成财务报告时，系统应能够识别和统计带有即时买断标签的交易，同时保持原有的收入支出计算逻辑
5. 当显示交易列表时，系统应清楚标示即时买断类型标签的交易记录

### 需求9：首页集成维护

**用户故事：** 作为系统用户，我希望现有首页功能保持完整，以便在享受新导航功能的同时继续使用熟悉的功能。

#### 验收标准

1. 当通过底部导航访问首页时，系统应显示现有的HomePage.vue内容
2. 当首页加载时，系统应保持所有现有功能和数据显示
3. 当与底部导航集成时，系统不应破坏现有首页功能
4. 当首页处于活动状态时，系统应在底部导航中高亮显示"首页"